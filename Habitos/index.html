<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de H√°bitos ‚ú®</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-color: #f4f7f8; --card-color: #ffffff; --primary-text: #34495e; --secondary-text: #95a5a6;
            --accent-color: #88c0d0; --accent-hover: #5e81ac; --done-bg: #e5f5e0; --done-accent: #a3be8c;
            --done-accent-dark: #819b6d; --delete-color: #bf616a; --shadow-color: rgba(90, 100, 120, 0.1);
            --calendar-day-bg: #eef2f3; --celebrate-bg: #4a4a68; --celebrate-text: #ffffff;
            --edit-mode-color: #d08770;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color); color: var(--primary-text); padding: 2rem 1rem;
        }

        .container { max-width: 600px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 2rem; }
        header h1 { font-size: 2.5rem; margin-bottom: 1rem; }
        header h1 span { color: var(--accent-color); }
        .header-buttons { display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; }
        
        .header-btn {
            background-color: var(--accent-color); color: white; border: none; border-radius: 8px;
            padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s;
        }
        .header-btn:hover { background-color: var(--accent-hover); }
        #toggle-edit-btn.active { background-color: var(--edit-mode-color); }

        .add-habit-form { display: flex; gap: 0.5rem; margin-bottom: 2rem; }
        .add-habit-form input { border: 2px solid #e0e0e0; border-radius: 8px; padding: 0.8rem; font-size: 1rem; transition: border-color 0.3s; flex-grow: 1; }
        .add-habit-form input:focus { outline: none; border-color: var(--accent-color); }
        .add-habit-form .input-emoji { flex-grow: 0; width: 60px; text-align: center; font-size: 1.5rem; }
        .add-habit-form button { background-color: var(--accent-color); color: white; border: none; border-radius: 8px; padding: 0 1rem; font-size: 1.5rem; font-weight: 600; cursor: pointer; transition: background-color 0.3s; }
        .add-habit-form button:hover { background-color: var(--accent-hover); }

        .habits-list { display: grid; gap: 1rem; }
        .habit-card {
            display: flex; align-items: center; gap: 1rem; padding: 1rem; background-color: var(--card-color);
            border-radius: 10px; transition: all 0.3s ease; box-shadow: 0 4px 10px var(--shadow-color);
        }
        .habit-card .habit-emoji { font-size: 2rem; }
        .habit-card .habit-name { flex-grow: 1; font-size: 1.1rem; }
        .habit-card .action-buttons { display: flex; gap: 0.5rem; }
        .action-btn { background: none; border: none; cursor: pointer; font-size: 1.5rem; padding: 0.2rem; transition: transform 0.2s, color 0.3s; }
        .action-btn:hover { transform: scale(1.15); }
        
        .complete-btn { color: var(--secondary-text); }
        .habit-card.done { background-color: var(--done-bg); border-left: 4px solid var(--done-accent); }
        .habit-card.done .habit-name { text-decoration: line-through; color: var(--secondary-text); }
        .habit-card.done .complete-btn { color: var(--done-accent); }

        .edit-mode .habit-card { cursor: grab; }
        .edit-mode .habit-card:active { cursor: grabbing; }
        .edit-btn { color: var(--secondary-text); } .edit-btn:hover { color: var(--accent-hover); }
        .delete-btn { color: var(--secondary-text); } .delete-btn:hover { color: var(--delete-color); }
        .habit-card.dragging { opacity: 0.5; }
        .dragging-over { border-top: 3px solid var(--edit-mode-color) !important; }

        #empty-state { text-align: center; color: var(--secondary-text); padding: 2rem 0; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5);
            display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s; z-index: 1000;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        
        .modal-content {
            background: var(--card-color); border-radius: 15px; padding: 2rem; width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); transform: scale(0.95); transition: transform 0.3s;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }

        .calendar-modal { max-width: 450px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .calendar-header h3 { font-size: 1.2rem; margin: 0; }
        .calendar-nav-btn { background: none; border: none; font-size: 2rem; cursor: pointer; color: var(--primary-text); }
        .close-modal-btn { font-size: 1.5rem; color: var(--secondary-text); }
        .calendar-grid-container { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .calendar-day-name { font-weight: 600; color: var(--secondary-text); padding-bottom: 0.5rem; }
        .calendar-day {
            height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 8px;
            background-color: var(--calendar-day-bg); transition: background 0.3s, border 0.3s; font-weight: 500;
        }
        .calendar-day.today { box-shadow: 0 0 0 2px var(--accent-color); }
        .calendar-day.full-completion { background: var(--done-accent); border: 2px solid var(--done-accent-dark); font-size: 1.5rem; line-height: 1; }

        .celebration-modal {
            max-width: 400px; background: var(--celebrate-bg); color: var(--celebrate-text);
            text-align: center; padding: 3rem 2rem;
        }
        .celebration-modal h2 { font-size: 3rem; margin-bottom: 1rem; }
        .celebration-modal p { font-size: 1.2rem; margin-bottom: 2rem; }
        .celebration-modal button { background-color: var(--accent-color); color: white; border: none; border-radius: 8px; padding: 0.8rem 2rem; font-size: 1rem; cursor: pointer; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Mis H√°bitos <span>Diarios</span></h1>
            <div class="header-buttons">
                <button class="header-btn" id="toggle-edit-btn">Editar ‚úèÔ∏è</button>
                <button class="header-btn" id="open-calendar-btn">Ver Calendario üìÖ</button>
            </div>
        </header>
    
        <main>
            <form class="add-habit-form" id="add-habit-form">
                <input type="text" id="habit-name" placeholder="Nuevo h√°bito..." required>
                <input type="text" id="habit-emoji" placeholder="‚ú®" maxlength="2" required>
                <button type="submit" title="A√±adir h√°bito">+</button>
            </form>
            <div class="habits-list" id="habits-list"></div>
        </main>
    </div>

    <!-- Modales Completos -->
    <div class="modal-overlay" id="calendar-modal-overlay">
        <div class="modal-content calendar-modal">
            <div class="calendar-header">
                <button class="calendar-nav-btn" id="prev-month-btn">&lt;</button>
                <h3 id="calendar-month-year"></h3>
                <button class="calendar-nav-btn" id="next-month-btn">&gt;</button>
                <button class="calendar-nav-btn close-modal-btn" id="close-calendar-btn">‚úï</button>
            </div>
            <div class="calendar-grid-container" id="calendar-weekdays"></div>
            <div class="calendar-grid-container" id="calendar-grid"></div>
        </div>
    </div>
    
    <div class="modal-overlay" id="celebration-modal-overlay">
        <div class="modal-content celebration-modal">
            <h2>üéâ ¬°D√≠a Completado! üéâ</h2>
            <p id="motivation-message"></p>
            <button id="close-celebration-btn">Cerrar</button>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- ELEMENTOS DEL DOM ---
        const form = document.getElementById('add-habit-form');
        const habitInputName = document.getElementById('habit-name');
        const habitInputEmoji = document.getElementById('habit-emoji');
        const habitsList = document.getElementById('habits-list');
        const toggleEditBtn = document.getElementById('toggle-edit-btn');
        // Calendario
        const openCalendarBtn = document.getElementById('open-calendar-btn');
        const calendarModalOverlay = document.getElementById('calendar-modal-overlay');
        const closeCalendarBtn = document.getElementById('close-calendar-btn');
        const prevMonthBtn = document.getElementById('prev-month-btn');
        const nextMonthBtn = document.getElementById('next-month-btn');
        const calendarMonthYear = document.getElementById('calendar-month-year');
        const calendarGrid = document.getElementById('calendar-grid');
        const calendarWeekdays = document.getElementById('calendar-weekdays');
        // Celebraci√≥n
        const celebrationModalOverlay = document.getElementById('celebration-modal-overlay');
        const motivationMessage = document.getElementById('motivation-message');
        const closeCelebrationBtn = document.getElementById('close-celebration-btn');
        
        // --- ESTADO ---
        let habits = JSON.parse(localStorage.getItem('simpleHabitsApp')) || [];
        let calendarDate = new Date();
        let isEditMode = false;
        const motivationMessages = ["¬°Lo lograste!", "¬°D√≠a perfecto!", "¬°Excelente trabajo!", "¬°Enhorabuena!", "¬°Sigue as√≠!"];

        // --- FUNCIONES ---
        const getFormattedDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };
        const saveHabits = () => localStorage.setItem('simpleHabitsApp', JSON.stringify(habits));

        const renderHabitsList = () => {
            habitsList.innerHTML = '';
            habitsList.classList.toggle('edit-mode', isEditMode);
            if (habits.length === 0) {
                habitsList.innerHTML = `<p id="empty-state">¬°A√±ade tu primer h√°bito para empezar!</p>`;
                return;
            }
            const todayStr = getFormattedDate(new Date());
            habits.forEach(habit => {
                const isDoneToday = habit.completedDates.includes(todayStr);
                const habitCard = document.createElement('div');
                habitCard.className = 'habit-card';
                if (isDoneToday && !isEditMode) habitCard.classList.add('done');
                habitCard.dataset.id = habit.id;
                
                let actionButtonsHTML = '';
                if (isEditMode) {
                    habitCard.setAttribute('draggable', 'true');
                    actionButtonsHTML = `
                        <button class="action-btn edit-btn" title="Editar h√°bito">‚úèÔ∏è</button>
                        <button class="action-btn delete-btn" title="Eliminar h√°bito">üóëÔ∏è</button>
                    `;
                } else {
                    habitCard.removeAttribute('draggable');
                    actionButtonsHTML = `
                        <button class="action-btn complete-btn" title="Marcar como hecho">${isDoneToday ? '‚úîÔ∏è' : '‚ö™'}</button>
                    `;
                }
                habitCard.innerHTML = `
                    <span class="habit-emoji">${habit.emoji}</span>
                    <p class="habit-name">${habit.name}</p>
                    <div class="action-buttons">${actionButtonsHTML}</div>
                `;
                habitsList.appendChild(habitCard);
            });
        };

        const addHabit = (e) => {
            e.preventDefault();
            const name = habitInputName.value.trim();
            const emoji = habitInputEmoji.value.trim() || '‚ú®';
            if (!name) return;
            habits.push({ id: Date.now(), name, emoji, completedDates: [] });
            saveHabits();
            renderHabitsList();
            form.reset();
        };
        
        const handleHabitListClick = (e) => {
            const card = e.target.closest('.habit-card');
            if (!card) return;
            const habitId = Number(card.dataset.id);
            const habit = habits.find(h => h.id === habitId);

            if (isEditMode) {
                if (e.target.closest('.edit-btn')) {
                    const newName = prompt('Edita el nombre del h√°bito:', habit.name);
                    if (newName !== null && newName.trim() !== '') habit.name = newName.trim();
                    const newEmoji = prompt('Edita el emoji:', habit.emoji);
                    if (newEmoji !== null && newEmoji.trim() !== '') habit.emoji = newEmoji.trim();
                }
                if (e.target.closest('.delete-btn')) {
                    if (confirm(`¬øSeguro que quieres eliminar el h√°bito "${habit.name}"?`)) {
                        habits = habits.filter(h => h.id !== habitId);
                    }
                }
            } else {
                if (e.target.closest('.complete-btn')) {
                    const todayStr = getFormattedDate(new Date());
                    const dateIndex = habit.completedDates.indexOf(todayStr);
                    if (dateIndex > -1) {
                        habit.completedDates.splice(dateIndex, 1);
                    } else {
                        habit.completedDates.push(todayStr);
                        checkAllHabitsCompleted();
                    }
                }
            }
            saveHabits();
            renderHabitsList();
        };

        const toggleEditMode = () => {
            isEditMode = !isEditMode;
            toggleEditBtn.classList.toggle('active', isEditMode);
            toggleEditBtn.innerHTML = isEditMode ? 'Hecho ‚úÖ' : 'Editar ‚úèÔ∏è';
            renderHabitsList();
        };

        // --- L√ìGICA DE DRAG & DROP ---
        habitsList.addEventListener('dragstart', (e) => { if (!isEditMode) return; e.target.classList.add('dragging'); });
        habitsList.addEventListener('dragend', (e) => { if (!isEditMode) return; e.target.classList.remove('dragging'); });
        habitsList.addEventListener('dragover', (e) => {
            if (!isEditMode) return;
            e.preventDefault();
            const draggingCard = document.querySelector('.dragging');
            const targetCard = e.target.closest('.habit-card');
            if (targetCard && targetCard !== draggingCard) {
                document.querySelectorAll('.dragging-over').forEach(el => el.classList.remove('dragging-over'));
                targetCard.classList.add('dragging-over');
            }
        });
        habitsList.addEventListener('dragleave', (e) => e.target.closest('.habit-card')?.classList.remove('dragging-over'));
        habitsList.addEventListener('drop', (e) => {
            if (!isEditMode) return;
            e.preventDefault();
            const draggingCard = document.querySelector('.dragging');
            const targetCard = e.target.closest('.habit-card');
            if (targetCard && targetCard !== draggingCard) {
                const draggedId = Number(draggingCard.dataset.id);
                const targetId = Number(targetCard.dataset.id);
                const draggedIndex = habits.findIndex(h => h.id === draggedId);
                const targetIndex = habits.findIndex(h => h.id === targetId);
                const [movedItem] = habits.splice(draggedIndex, 1);
                habits.splice(targetIndex, 0, movedItem);
                saveHabits();
            }
            document.querySelectorAll('.dragging-over').forEach(el => el.classList.remove('dragging-over'));
            renderHabitsList();
        });

        // --- L√ìGICA DE MODALES ---
        const checkAllHabitsCompleted = () => {
            const todayStr = getFormattedDate(new Date());
            const celebrationShown = localStorage.getItem('celebration_shown_' + todayStr);
            if (celebrationShown) return;
            const allDone = habits.length > 0 && habits.every(h => h.completedDates.includes(todayStr));
            if (allDone) {
                const randomIndex = Math.floor(Math.random() * motivationMessages.length);
                motivationMessage.textContent = motivationMessages[randomIndex];
                celebrationModalOverlay.classList.add('visible');
                confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });
                localStorage.setItem('celebration_shown_' + todayStr, 'true');
            }
        };

        const renderCalendar = () => {
            calendarGrid.innerHTML = '';
            const month = calendarDate.getMonth();
            const year = calendarDate.getFullYear();
            calendarMonthYear.textContent = calendarDate.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const startDay = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1;
            const completionsByDate = {};
            habits.forEach(habit => {
                habit.completedDates.forEach(date => {
                    completionsByDate[date] = (completionsByDate[date] || 0) + 1;
                });
            });

            for (let i = 0; i < startDay; i++) { calendarGrid.appendChild(document.createElement('div')); }

            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.classList.add('calendar-day');
                const dayStr = getFormattedDate(new Date(year, month, day));
                
                dayEl.innerHTML = '';
                dayEl.style.background = '';
                
                if (dayStr === getFormattedDate(new Date())) dayEl.classList.add('today');

                const completionCount = completionsByDate[dayStr] || 0;
                let percentage = 0;
                if (habits.length > 0) {
                    percentage = Math.round((completionCount / habits.length) * 100);
                }

                if (percentage === 100) {
                    dayEl.classList.add('full-completion');
                    dayEl.innerHTML = 'ü§©';
                } else if (percentage > 0) {
                    dayEl.textContent = day;
                    dayEl.style.background = `linear-gradient(to top, var(--done-accent) ${percentage}%, var(--calendar-day-bg) ${percentage}%)`;
                } else {
                    dayEl.textContent = day;
                }
                
                calendarGrid.appendChild(dayEl);
            }
        };
        
        const setupCalendarWeekdays = () => {
            calendarWeekdays.innerHTML = '';
            const weekdays = ['L', 'M', 'X', 'J', 'V', 'S', 'D'];
            weekdays.forEach(day => {
                const dayNameEl = document.createElement('div');
                dayNameEl.className = 'calendar-day-name';
                dayNameEl.textContent = day;
                calendarWeekdays.appendChild(dayNameEl);
            });
        };

        // --- EVENT LISTENERS ---
        form.addEventListener('submit', addHabit);
        habitsList.addEventListener('click', handleHabitListClick);
        toggleEditBtn.addEventListener('click', toggleEditMode);
        
        openCalendarBtn.addEventListener('click', () => {
            calendarDate = new Date();
            renderCalendar();
            calendarModalOverlay.classList.add('visible');
        });
        closeCalendarBtn.addEventListener('click', () => calendarModalOverlay.classList.remove('visible'));
        calendarModalOverlay.addEventListener('click', (e) => {
            if (e.target === calendarModalOverlay) calendarModalOverlay.classList.remove('visible');
        });
        prevMonthBtn.addEventListener('click', () => { calendarDate.setMonth(calendarDate.getMonth() - 1); renderCalendar(); });
        nextMonthBtn.addEventListener('click', () => { calendarDate.setMonth(calendarDate.getMonth() + 1); renderCalendar(); });
        closeCelebrationBtn.addEventListener('click', () => celebrationModalOverlay.classList.remove('visible'));

        // --- INICIALIZACI√ìN ---
        setupCalendarWeekdays();
        renderHabitsList();
    });
    </script>
</body>
</html>